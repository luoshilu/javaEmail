package send;

import java.util.Properties;

import java.util.Properties;
import javax.activation.DataHandler;
import javax.activation.FileDataSource;
import javax.mail.Address;
import javax.mail.BodyPart;
import javax.mail.Message;
import javax.mail.Multipart;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeBodyPart;
import javax.mail.internet.MimeMessage;
import javax.mail.internet.MimeMultipart;

public class sendEmail {
	 public boolean send (String from, String password, String setname, String subject, String messages) {
		
        try{
            Properties props=new Properties();
            //传递一个邮件服务器名smtp.163.com
            //mail.smtp.host代表是发信人所在的邮箱服务器名
            props.put("mail.smtp.host", "smtp.sina.com");
            props.put("mail.smtp.auth", true);
            //对于发送邮件，只需要保证发送人所在的邮件服务器正确打开就可以了
            //收信人的邮箱可以是任意地址，如@163.com,@qq.com,@126.com
                                
            //创建一个程序与邮件服务器的通信
            Session mailConnection=Session.getInstance(props,null);
            Message msg=new MimeMessage(mailConnection);
                                
            //创建一个要输入用户名和指令的
            //Session mailConnection=Session.getInstance(props,new MailAuthenticator());
                                
                                
            //设置发送人和接受人
            Address sender=new InternetAddress(from);
            Address receiver=new InternetAddress(setname);
                                
            /*
             * 群发邮件的方法
             * StringBuffer buffer=new StringBuffer();
             * buffer.append("11@163.com,")
             * buffer.append("22@163.com")
             * String all=buffer.toString();
             * Address[] allre=InternetAddress.parse(all);
             * msg.setRecipient(Message.RecipientType.TO, allre);
             */
            msg.setFrom(sender);
            msg.setRecipient(Message.RecipientType.TO, receiver);
            msg.setSubject(subject);
                                
            //msg.setContent("<h1>Hello<h1>", "text/plain");
                                
                                
            //下面是模拟发送带附件的邮件
            //新建一个MimeMultipart对象用来存放多个BodyPart对象
            Multipart mtp=new MimeMultipart();
            //------设置信件文本内容------
            //新建一个存放信件内容的BodyPart对象
            BodyPart mdp=new MimeBodyPart();
            //给BodyPart对象设置内容和格式/编码方式
           // mdp.setContent("<h1>hello</h1><b>加粗</b>","text/html;charset=utf8");
            mdp.setContent(messages,"text/html;charset=utf8");
            
            //将含有信件内容的BodyPart加入到MimeMultipart对象中
            mtp.addBodyPart(mdp);
                                
            //设置信件的附件(用本地机上的文件作为附件)
//            mdp=new MimeBodyPart();
//            FileDataSource fds=new FileDataSource("/home/tenlee/图片/head.jpg");
//            DataHandler dh=new DataHandler(fds);
//            mdp.setFileName("head.jpg");//可以和原文件名不一致
//            mdp.setDataHandler(dh);
//            mtp.addBodyPart(mdp);
//            //把mtp作为消息对象的内容
            msg.setContent(mtp);
                                
            //以上为发送带附件的方式
            //先进行存储邮件
            msg.saveChanges();
                                
            Transport trans=mailConnection.getTransport("smtp");
           // String username = from;
            //String pw = password;
            //邮件服务器名,用户名，密码
            trans.connect("smtp.sina.com", from,  password);
            trans.sendMessage(msg, msg.getAllRecipients());
            trans.close();
            return true;
        }catch(Exception e)
        {
        	return false;
        } 
	}
}